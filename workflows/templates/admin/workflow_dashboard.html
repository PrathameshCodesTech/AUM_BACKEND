{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}Workflow Dashboard{% endblock %}

{% block content %}
<h1>Approval Workflow Dashboard</h1>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
    <div style="background: #fff; padding: 20px; border-radius: 5px; border-left: 4px solid #ffc107; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3 style="margin: 0; color: #6c757d; font-size: 14px;">Pending</h3>
        <p style="margin: 10px 0 0; font-size: 32px; font-weight: 700; color: #ffc107;">{{ stats.pending }}</p>
    </div>
    
    <div style="background: #fff; padding: 20px; border-radius: 5px; border-left: 4px solid #28a745; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3 style="margin: 0; color: #6c757d; font-size: 14px;">Approved</h3>
        <p style="margin: 10px 0 0; font-size: 32px; font-weight: 700; color: #28a745;">{{ stats.approved }}</p>
    </div>
    
    <div style="background: #fff; padding: 20px; border-radius: 5px; border-left: 4px solid #dc3545; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3 style="margin: 0; color: #6c757d; font-size: 14px;">Rejected</h3>
        <p style="margin: 10px 0 0; font-size: 32px; font-weight: 700; color: #dc3545;">{{ stats.rejected }}</p>
    </div>
    
    <div style="background: #fff; padding: 20px; border-radius: 5px; border-left: 4px solid #007bff; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3 style="margin: 0; color: #6c757d; font-size: 14px;">Assigned to You</h3>
        <p style="margin: 10px 0 0; font-size: 32px; font-weight: 700; color: #007bff;">{{ stats.my_pending }}</p>
    </div>
</div>

<div style="background: #fff; padding: 20px; border-radius: 5px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h2>By Workflow Type (Last 30 Days)</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Type</th>
                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #dee2e6;">Count</th>
            </tr>
        </thead>
        <tbody>
            {% for item in by_type %}
            <tr>
                <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">{{ item.workflow_type }}</td>
                <td style="padding: 10px; text-align: right; border-bottom: 1px solid #dee2e6; font-weight: 600;">{{ item.count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="background: #fff; padding: 20px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h2>Recent Approvals</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8f9fa;">
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Type</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Requested By</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Reviewed By</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Status</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Date</th>
            </tr>
        </thead>
        <tbody>
            {% for workflow in recent_approvals %}
            <tr>
                <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">{{ workflow.get_workflow_type_display }}</td>
                <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">{{ workflow.requested_by.username }}</td>
                <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">{{ workflow.reviewed_by.username }}</td>
                <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">
                    <span style="background-color: {% if workflow.status == 'approved' %}#28a745{% else %}#dc3545{% endif %}; color: white; padding: 2px 8px; border-radius: 3px; font-size: 11px;">
                        {{ workflow.get_status_display }}
                    </span>
                </td>
                <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">{{ workflow.reviewed_at|date:"d M Y, H:i" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
